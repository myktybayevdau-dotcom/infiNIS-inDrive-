# infiNIS-inDrive-
CarCheckBot ‚Äî —ç—Ç–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø ML-—Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è. –ú–æ–¥–µ–ª—å –Ω–∞ –±–∞–∑–µ YOLO –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞—à–∏–Ω—ã (–±–∏—Ç–∞—è/—Ü–µ–ª–∞—è) –∏ –ª–æ–∫–∞–ª–∏–∑—É–µ—Ç –¥–µ—Ñ–µ–∫—Ç—ã (—Ü–∞—Ä–∞–ø–∏–Ω—ã, –≤–º—è—Ç–∏–Ω—ã, —Ä–∂–∞–≤—á–∏–Ω–∞). –ë–æ—Ç –≤ Telegram –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–æ—Ç–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –æ—Ç–º–µ—á–µ–Ω–Ω—ã–º–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏.
# CarCheckBot üöóü§ñ

Telegram-–±–æ—Ç –Ω–∞ –±–∞–∑–µ YOLO –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è –ø–æ —Ñ–æ—Ç–æ.  
–ú–æ–¥–µ–ª—å –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∞–≤—Ç–æ (—Ü–µ–ª–æ–µ / –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω–æ–µ, —á–∏—Å—Ç–æ–µ / –≥—Ä—è–∑–Ω–æ–µ) –∏ –ª–æ–∫–∞–ª–∏–∑—É–µ—Ç –¥–µ—Ñ–µ–∫—Ç—ã: **—Ü–∞—Ä–∞–ø–∏–Ω—ã, –≤–º—è—Ç–∏–Ω—ã, —Ä–∂–∞–≤—á–∏–Ω–∞**.  

---

–°–æ–∑–¥–∞–π –ø–∞–ø–∫—É, –Ω–∞–ø—Ä–∏–º–µ—Ä:
CarCheckBot

–í —ç—Ç—É –ø–∞–ø–∫—É –Ω—É–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å:

best.pt ‚Äî —Ç–≤–æ—è –æ–±—É—á–µ–Ω–Ω–∞—è YOLO-–º–æ–¥–µ–ª—å

bot.py ‚Äî —Ñ–∞–π–ª —Å –∫–æ–¥–æ–º —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞

–£—Å—Ç–∞–Ω–æ–≤–∏ Python 3.12 (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç).

–£—Å—Ç–∞–Ω–æ–≤–∏ –Ω—É–∂–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É:
pip install ultralytics aiogram opencv-python torch numpy

–û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª bot.py –≤ IDLE (Python 3.12).

–í—Å—Ç–∞–≤—å —Å–≤–æ–π API-–∫–ª—é—á Telegram –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é API_TOKEN.

–£–∫–∞–∂–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –º–æ–¥–µ–ª–∏ –≤ —Å—Ç—Ä–æ–∫–µ —Å model = YOLO(...).

–ó–∞–ø—É—Å—Ç–∏ –∫–æ–¥ —á–µ—Ä–µ–∑ F5 (Run ‚Üí Run Module).

–í Telegram –æ—Ç–∫—Ä–æ–π —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ –º–∞—à–∏–Ω—ã.
import io
import cv2
import torch
import asyncio
import numpy as np
from ultralytics import YOLO
from aiogram import Bot, Dispatcher, F, Router
from aiogram.filters import CommandStart
from aiogram.types import Message, BufferedInputFile

API_TOKEN = "—Å—é–¥–∞ –≤—Å—Ç–∞–≤—å —Å–≤–æ–π —Ç–æ–∫–µ–Ω"

router = Router()

BAD_KEYWORDS = ["dunt", "dent", "rust", "scr", "scratch", "scracth"]

def severity(box, img_shape):
    x1, y1, x2, y2 = box.xyxy[0].cpu().numpy()
    box_area = (x2 - x1) * (y2 - y1)
    img_area = img_shape[0] * img_shape[1]
    ratio = box_area / img_area

    if ratio < 0.05:
        return "–º–∞–ª–µ–Ω—å–∫–∏–π –¥–µ—Ñ–µ–∫—Ç"
    elif ratio < 0.15:
        return "—É–º–µ—Ä–µ–Ω–Ω—ã–π –¥–µ—Ñ–µ–∫—Ç"
    else:
        return "–∫—Ä—É–ø–Ω—ã–π –¥–µ—Ñ–µ–∫—Ç"

@router.message(CommandStart())
async def start(m: Message):
    await m.answer("–û—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ –º–∞—à–∏–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏")

@router.message(F.photo)
async def on_photo(m: Message, bot: Bot):
    buf = io.BytesIO()
    await bot.download(m.photo[-1], destination=buf)
    img = cv2.imdecode(np.frombuffer(buf.getvalue(), np.uint8), cv2.IMREAD_COLOR)

    results = await asyncio.to_thread(lambda: model(img, conf=0.05, imgsz=640, verbose=False))
    res = results[0]
    plotted = res.plot()

    detected_info = []
    boxes = getattr(res, "boxes", None)

    if boxes is not None and len(boxes) > 0:
        for box in boxes:
            cls_id = int(box.cls.cpu().numpy()[0])
            cls_name = model.names.get(cls_id, str(cls_id))
            sev = severity(box, img.shape)
            detected_info.append(f"{cls_name} ({sev})")

    if detected_info:
        caption = f"–ù–∞–π–¥–µ–Ω—ã –¥–µ—Ñ–µ–∫—Ç—ã: {', '.join(detected_info)}"
    else:
        caption = "–î–µ—Ñ–µ–∫—Ç–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ"

    ok, enc = cv2.imencode(".jpg", plotted)
    if ok:
        await m.answer_photo(
            BufferedInputFile(enc.tobytes(), filename="result.jpg"),
            caption=caption
        )
    else:
        await m.answer("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ")

async def main():
    global model
    model = YOLO(r"C:\Users\...\CarCheckBot\best.pt")

    if torch.cuda.is_available():
        model.to("cuda")

    bot = Bot(API_TOKEN)
    dp = Dispatcher()
    dp.include_router(router)
    await dp.start_polling(bot)

if name == "main":
    asyncio.run(main())
    –∫–æ–¥ –¥–ª—è –±–æ—Ç–∞
    8140893616:AAHWFDGPp2Tx7gt43oO3tl4-YpzhbukOVSQ
